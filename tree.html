<head>
  <title>TreeLand</title>
</head>

<body>
  {{> navigation}}
  <header>
    <h1>Hi, {{currentUser.username}}</h1>
  </header>
  {{> application}}
</body>

<template name="application">
  <div class="container-fluid">
    {{#if noStories}}
      <p>Create your root node...</p>
      {{> insertStoryForm}}
    {{/if}}

    <div class="row">
      {{#each stories}}
        {{> story}}
      {{/each}}
    </div>
  </div>
</template>

<template name="navigation">
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="#">TreeLand</a>
        <p class="navbar-text navbar-right">{{> loginButtons}}</p>
      </div>
    </div>
  </nav>
</template>

<template name="story">
  <div class="story {{sizeClass depth}}">
    {{#if editing}}
      {{> updateStoryForm editingStory=this}}
    {{else}}
      <p class="title">{{title}}</p>
    {{/if}}

    <div class="btn-group" role="group">
      <button type="button" class="complete btn btn-default">
        <span class="glyphicon glyphicon-ok"></span>
      </button>

      <button type="button" class="edit btn btn-default">
        <span class="glyphicon glyphicon-pencil"></span>
      </button>

      <button type="button" class="delete btn btn-default">
        <span class="glyphicon glyphicon-remove"></span>
      </button>
    </div>
    <div class="clearfix"></div>
  </div>
</template>


<template name="insertStoryForm">
  {{#autoForm collection="Stories" id="insertStoryForm" type="insert" class="form-inline title"}}
    <div class="form-group">
      {{> afQuickField name='title' label=false class="form-control"}}
    </div>
    {{> afQuickField name='editing' label=false class="form-control" type="hidden" value=true}}
    {{> afQuickField name='depth' label=false class="form-control" type="hidden" value=0}}
    {{> afQuickField name='position' label=false class="form-control" type="hidden" value=0}}
    {{> afQuickField name='parentId' label=false class="form-control" type="hidden" value=parentId}}
  {{/autoForm}}
</template>

<template name="updateStoryForm">
  {{#autoForm collection="Stories" id="updateStoryForm" doc=editingStory type="update" class="form-inline title"}}
    <div class="form-group">
      {{> afQuickField name='title' label=false class="form-control title-edit"}}
    </div>
    {{> afQuickField name='editing' label=false class="form-control" type="hidden" value=true}}
    {{> afQuickField name='depth' label=false class="form-control" type="hidden" value=0}}
    {{> afQuickField name='position' label=false class="form-control" type="hidden" value=0}}
    {{> afQuickField name='parentId' label=false class="form-control" type="hidden" value=parentId}}
  {{/autoForm}}
</template>
